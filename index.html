<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TESOURA — CONTROLE DO FUTEBOL</title>

  <!-- CSS no root (puxa o CSS real de app/css/) -->
  <link rel="stylesheet" href="ui.css?v=20251227" />
  <link rel="stylesheet" href="tesoura_shell.css?v=20251227" />

  <!-- Config no root (evita 404). Se você já usa app/js/config.js, também pode manter. -->
  <script src="config.js?v=20251227"></script>
  <script src="js/auth.js?v=20251227"></script>

  <style>
    .page-wrap{min-height:100vh;display:flex;flex-direction:column;}
    .topbar{display:flex;align-items:center;justify-content:space-between;padding:14px 18px;border-bottom:1px solid rgba(255,255,255,.08)}
    .brand{color:#ff8c1a;font-weight:800;letter-spacing:.5px}
    .top-right{display:flex;gap:10px;align-items:center}
    .pill{border:1px solid rgba(255,255,255,.12);border-radius:999px;padding:6px 10px;color:#cfd6e6;font-size:12px}

    .card{max-width:760px;margin:48px auto 0 auto;background:rgba(8,18,40,.7);border:1px solid rgba(255,255,255,.10);border-radius:18px;box-shadow:0 12px 40px rgba(0,0,0,.35);padding:26px}
    .title{font-size:36px;font-weight:800;margin:0 0 10px 0;color:#e9eefc}
    .sub{margin:0 0 16px 0;color:#b8c2d8}

    .row{display:flex;gap:14px;flex-wrap:wrap;align-items:flex-end}
    .field{flex:1;min-width:260px}
    label{display:block;color:#cfd6e6;font-weight:700;margin:10px 0 6px 0}
    select,input{width:100%;padding:12px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.14);background:rgba(2,10,24,.65);color:#e9eefc;outline:none}

    .btns{display:flex;gap:12px;margin-top:16px}
    .btn{padding:10px 16px;border-radius:12px;border:1px solid rgba(255,255,255,.14);cursor:pointer;font-weight:800;letter-spacing:.3px}
    .btn.enter{background:#00b36b;color:#041316}
    .btn.clear{background:#ff8c1a;color:#1b0e00}

    .msg{margin-top:12px;font-weight:800}
    .msg.ok{color:#00d47a}
    .msg.err{color:#ff4d4d}
    .hint{margin-top:10px;color:#9fb0cf}

    @media (max-width:720px){
      .card{margin:22px 12px 0 12px;padding:18px}
      .title{font-size:30px}
    }
  </style>
</head>
<body>
  <div class="page-wrap">
    <div class="topbar">
      <div class="brand">TESOURA — CONTROLE DO FUTEBOL</div>
      <div class="top-right">
        <div class="pill" id="pillMode">Modo: —</div>
        <div class="pill" id="pillBuild">BUILD: —</div>
      </div>
    </div>

    <div class="card">
      <h1 class="title">Entrar</h1>
      <p class="sub">Digite a senha e clique em ENTRAR.</p>

      <div class="row">
        <div class="field">
          <label for="mode">TIPO DE ACESSO</label>
          <select id="mode">
            <option value="diretoria">Diretoria</option>
            <option value="jogadores">Jogadores (visual)</option>
          </select>
        </div>
        <div class="field">
          <label for="pin">SENHA</label>
          <input id="pin" type="password" autocomplete="current-password" placeholder="Digite a senha" />
        </div>
      </div>

      <div class="btns">
        <button class="btn enter" id="btnEnter">ENTRAR</button>
        <button class="btn clear" id="btnClear">LIMPAR</button>
      </div>

      <div id="msg" class="msg"></div>
      <div class="hint">Dica: se abriu direto um painel, use o botão SAIR e volte aqui.</div>
    </div>
  </div>

  <script>
    // BUILD na tela (se vier por querystring ?build=...)
    const qs = new URLSearchParams(location.search);
    document.getElementById('pillBuild').textContent = 'BUILD: ' + (qs.get('build') || '—');

    const elMode = document.getElementById('mode');
    const elPin  = document.getElementById('pin');
    const elMsg  = document.getElementById('msg');
    const pillMode = document.getElementById('pillMode');

    function setMsg(text, ok){
      elMsg.textContent = text || '';
      elMsg.className = 'msg ' + (ok ? 'ok' : 'err');
    }

    function goAfterLogin(mode){
      // Salva sessão
      window.TESOURA_AUTH.setSession(mode);

      // Página inicial após login
      // (começa no JOGADORES, porque de lá você navega para os demais painéis)
      const build = qs.get('build') || 'noiframe_v1';
      const target = window.TESOURA_AUTH.joinUrl('legacy/tesoura_jogadores_teste.html?build=' + encodeURIComponent(build));
      location.href = target;
    }

    function tryLogin(){
      const mode = elMode.value;
      const pin = elPin.value || '';

      pillMode.textContent = 'Modo: ' + (mode === 'diretoria' ? 'Diretoria' : 'Jogadores (visual)');

      const ok = window.TESOURA_AUTH.validatePin(mode, pin);
      if(!ok){
        setMsg('Senha inválida.', false);
        return;
      }
      setMsg('OK. Abrindo painel...', true);
      setTimeout(()=>goAfterLogin(mode), 120);
    }

    // UI
    elMode.addEventListener('change', ()=>{
      pillMode.textContent = 'Modo: ' + (elMode.value === 'diretoria' ? 'Diretoria' : 'Jogadores (visual)');
      setMsg('', true);
    });

    document.getElementById('btnEnter').addEventListener('click', tryLogin);
    document.getElementById('btnClear').addEventListener('click', ()=>{ elPin.value=''; elPin.focus(); setMsg('', true); });
    elPin.addEventListener('keydown', (e)=>{ if(e.key === 'Enter') tryLogin(); });

    // Estado inicial
    pillMode.textContent = 'Modo: Diretoria';
    window.TESOURA_AUTH.applyLogoutIfRequested();
    elPin.focus();
  </script>
</body>
</html>
