<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>TESOURA - PAINÉIS</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Evita cache do próprio index -->
  <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />

  <style>
    body{margin:0;font-family:Arial,sans-serif;background-color:#0b1220;color:#ffffff}
    .topbar{background-color:#111827;padding:10px 20px;color:#ff7f27;font-weight:bold;font-size:18px;display:flex;align-items:center;justify-content:space-between;gap:12px}
    .topbar .title{display:flex;align-items:center;gap:10px}
    .topbar .actions{display:flex;align-items:center;gap:8px}
    .topbar .mode{font-size:12px;color:#ffffff;opacity:.9;background:#0b1220;border:1px solid #334155;padding:4px 8px;border-radius:999px}
    .topbar button{border:none;border-radius:6px;padding:6px 10px;font-weight:bold;cursor:pointer}
    .btn-login{background:#0ea5e9;color:#0b1220}
    .btn-logout{background:#ef4444;color:#ffffff;display:none}

    .tabs{display:flex;background-color:#111827;border-bottom:2px solid #ff7f27}
    .tab-btn{flex:1;padding:10px;cursor:pointer;text-align:center;border:none;background-color:#111827;color:#ffffff;font-weight:bold;font-size:14px}
    .tab-btn.active{background-color:#1f2937;color:#ff7f27;border-bottom:3px solid #ff7f27}
    .tab-content{display:none;height:calc(100vh - 80px);background-color:#0b1220}
    .tab-content.active{display:block}
    iframe{width:100%;height:100%;border:none;background-color:#0b1220}

    .auth-modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;z-index:9999;padding:16px}
    .auth-modal{width:min(420px, 100%);background:#111827;border:1px solid #334155;border-radius:10px;padding:14px}
    .auth-modal h3{margin:0 0 10px 0;color:#ff7f27}
    .auth-modal label{display:block;font-size:12px;margin-top:10px;color:#ffffff;opacity:.9}
    .auth-modal input{width:100%;box-sizing:border-box;margin-top:6px;padding:10px;border-radius:8px;border:1px solid #334155;background:#0b1220;color:#ffffff}
    .auth-modal .row{display:flex;gap:8px;margin-top:12px}
    .auth-modal .row button{flex:1}
    .btn-cancel{background:#334155;color:#ffffff}
    .btn-enter{background:#22c55e;color:#052e16}
    .auth-msg{margin-top:10px;font-size:12px;color:#ffffff;opacity:.9;min-height:16px}
  </style>
</head>

<body>
  <!-- TELA INICIAL (fica antes do app) -->
<div id="telaInicial" style="position:fixed;inset:0;z-index:9999;display:flex;align-items:center;justify-content:center;padding:16px;background:rgba(0,0,0,.80);">
  <div style="width:min(520px,100%);background:#081427;border:1px solid #334155;border-radius:14px;padding:18px;text-align:center;">
    <div style="color:#ff7f27;font-weight:900;font-size:22px;">GRUPO TESOURA I</div>
    <div style="color:#e5e7eb;margin-top:8px;font-weight:700;">ESPORTE, FAMÍLIA E AMIZADE</div>
    <div style="color:#e5e7eb;margin-top:18px;font-weight:800;">APLICATIVO DO GRUPO</div>

    <div style="display:flex;gap:14px;justify-content:center;margin-top:18px;flex-wrap:wrap;">
      <button id="btnEntrarJogadores" style="min-width:200px;border:none;border-radius:10px;padding:12px 14px;font-weight:900;cursor:pointer;background:#22c55e;color:#052e16;">
        ENTRAR JOGADORES
      </button>

      <button id="btnEntrarDiretoria" style="min-width:200px;border:none;border-radius:10px;padding:12px 14px;font-weight:900;cursor:pointer;background:#3b82f6;color:#06162f;">
        ENTRAR DIRETORIA
      </button>
    </div>

    <div id="msgTelaInicial" style="margin-top:12px;color:#e5e7eb;font-size:12px;min-height:16px;"></div>
  </div>
</div>

 <!-- BLOQUEIO DE VISUALIZAÇÃO (JOGADORES) -->
  <div id="viewGate" style="position:fixed;inset:0;background:rgba(0,0,0,.78);display:flex;align-items:center;justify-content:center;z-index:9998;padding:16px;">
    <div style="width:min(420px,100%);background:#111827;border:1px solid #334155;border-radius:10px;padding:14px;">
      <div style="color:#ff7f27;font-weight:bold;font-size:18px;margin-bottom:8px;">TESOURA – Visualização</div>
      <div style="font-size:12px;opacity:.9;margin-bottom:10px;">
        Digite a senha para <b>apenas visualizar</b> os painéis.
      </div>

      <label style="display:block;font-size:12px;margin-top:10px;opacity:.9;">Senha</label>
      <input id="viewPass" type="password"
        style="width:100%;box-sizing:border-box;margin-top:6px;padding:10px;border-radius:8px;border:1px solid #334155;background:#0b1220;color:#ffffff"
        placeholder="Senha de visualização" />

      <button id="viewEnter"
        style="margin-top:12px;width:100%;border:none;border-radius:8px;padding:10px;font-weight:bold;cursor:pointer;background:#22c55e;color:#052e16">
        ENTRAR
      </button>

      <div id="viewMsg" style="margin-top:10px;font-size:12px;opacity:.9;min-height:16px;"></div>
    </div>
  </div> 
  <div class="topbar">
    <div class="title">TESOURA – APLICATIVO DO GRUPO</div>
    <div class="actions">
      <div class="mode" id="modeBadge">Modo: Público</div>
      <button class="btn-login" id="btnLogin">ENTRAR (DIRETORIA)</button>
      <button class="btn-logout" id="btnLogout">SAIR</button>
    </div>
  </div>

  <div class="tabs">
    <button class="tab-btn active" onclick="abrirAba('aba-jogadores')">JOGADORES</button>
    <button class="tab-btn" onclick="abrirAba('aba-presenca')">PRESENÇA / ESCALAÇÃO</button>
    <button class="tab-btn" onclick="abrirAba('aba-controle')">CONTROLE GERAL</button>
    <button class="tab-btn" onclick="abrirAba('aba-mensalidade')">MENSALIDADE</button>
    <button class="tab-btn" onclick="abrirAba('aba-caixa')">CAIXA</button>
    <button class="tab-btn" onclick="abrirAba('aba-gols')">GOLS</button>
    <button class="tab-btn" onclick="abrirAba('aba-banco')">BANCO DE DADOS</button>
  </div>

  <div id="aba-jogadores" class="tab-content active">
    <iframe id="f-jogadores" data-src="tesoura_jogadores_teste.html"></iframe>
  </div>

  <div id="aba-presenca" class="tab-content">
    <iframe id="f-presenca" data-src="tesoura_presenca_escala_R5.html"></iframe>
  </div>

  <div id="aba-controle" class="tab-content">
    <iframe id="f-controle" data-src="tesoura_controle_geral_teste.html"></iframe>
  </div>

  <div id="aba-mensalidade" class="tab-content">
    <iframe id="f-mensalidade" data-src="tesoura_mensalidade_R4.html"></iframe>
  </div>

  <div id="aba-caixa" class="tab-content">
    <iframe id="f-caixa" data-src="tesoura_caixa_teste.html"></iframe>
  </div>

  <div id="aba-gols" class="tab-content">
    <iframe id="f-gols" data-src="tesoura_gols_teste.html"></iframe>
  </div>

  <div id="aba-banco" class="tab-content">
    <iframe id="f-banco" data-src="tesoura_banco_dados_teste.html"></iframe>
  </div>

  <!-- LOGIN DIRETORIA (não muda layout dos painéis) -->
  <div class="auth-modal-backdrop" id="authBackdrop">
    <div class="auth-modal">
      <h3>Entrar (Diretoria)</h3>
      <div style="font-size:12px;opacity:.9">Somente diretores conseguem salvar/editar. Todos podem visualizar.</div>

      <label for="authEmail">Email</label>
      <input id="authEmail" type="email" placeholder="diretor1@tesoura.local" autocomplete="username" />

      <label for="authPass">Senha</label>
      <input id="authPass" type="password" placeholder="senha" autocomplete="current-password" />

      <div class="row">
        <button class="btn-cancel" id="authCancel">Cancelar</button>
        <button class="btn-enter" id="authEnter">Entrar</button>
      </div>

      <div class="auth-msg" id="authMsg"></div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="app/js/config.js"></script>

  <script>
    // ===== SENHA DE VISUALIZAÇÃO (JOGADORES) =====
  const VIEW_PASSWORD = "TESOURA2026"; // <-- TROQUE AQUI PELA SUA SENHA
  const VIEW_KEY = "TESOURA_VIEW_OK";

  function openViewGate(){
    const gate = document.getElementById("viewGate");
    if(gate) gate.style.display = "flex";
  }
  function closeViewGate(){
    const gate = document.getElementById("viewGate");
    if(gate) gate.style.display = "none";
  }

  function initViewGate(){
    try{
      if(localStorage.getItem(VIEW_KEY) === "1"){
        closeViewGate();
      }else{
        openViewGate();
      }
    }catch(e){
      openViewGate();
    }

    const btn = document.getElementById("viewEnter");
    const inp = document.getElementById("viewPass");
    const msg = document.getElementById("viewMsg");

    function tryEnter(){
      const v = (inp.value || "").trim();
      if(v === VIEW_PASSWORD){
        try{ localStorage.setItem(VIEW_KEY, "1"); }catch(e){}
        closeViewGate();
        msg.textContent = "";
      }else{
        msg.textContent = "Senha incorreta.";
      }
    }

    if(btn) btn.onclick = tryEnter;
    if(inp) inp.onkeydown = (e)=>{ if(e.key === "Enter") tryEnter(); };
  }
  // ============================================
    // --- SUPABASE (login diretoria) ---
    const cfg = window.TESOURA_CONFIG || {};
    const sb = window.supabase?.createClient ? window.supabase.createClient(cfg.SUPABASE_URL, cfg.SUPABASE_KEY) : null;

    const btnLogin = document.getElementById('btnLogin');
    const btnLogout = document.getElementById('btnLogout');
    const modeBadge = document.getElementById('modeBadge');
    const backdrop = document.getElementById('authBackdrop');
    const authEmail = document.getElementById('authEmail');
    const authPass = document.getElementById('authPass');
    const authCancel = document.getElementById('authCancel');
    const authEnter = document.getElementById('authEnter');
    const authMsg = document.getElementById('authMsg');

    function setMode(isLogged){
      modeBadge.textContent = isLogged ? 'Modo: Diretoria' : 'Modo: Público';
      btnLogout.style.display = isLogged ? 'inline-block' : 'none';
      btnLogin.style.display = isLogged ? 'none' : 'inline-block';
      try { localStorage.setItem('TESOURA_LOGGED', isLogged ? '1' : '0'); } catch(e){}
    }

    async function refreshMode(){
      if(!sb){ setMode(false); return; }
      const { data } = await sb.auth.getSession();
      setMode(!!data?.session);
    }

    function openLogin(){
      authMsg.textContent = '';
      backdrop.style.display = 'flex';
      setTimeout(()=>authEmail.focus(), 50);
    }
    function closeLogin(){
      backdrop.style.display = 'none';
    }

    btnLogin.addEventListener('click', openLogin);
    authCancel.addEventListener('click', closeLogin);
    backdrop.addEventListener('click', (e)=>{ if(e.target === backdrop) closeLogin(); });

    authEnter.addEventListener('click', async ()=>{
      if(!sb){ authMsg.textContent = 'Erro: Supabase não carregou.'; return; }
      const email = (authEmail.value||'').trim();
      const password = (authPass.value||'').trim();
      if(!email || !password){ authMsg.textContent = 'Preencha Email e Senha.'; return; }
      authMsg.textContent = 'Entrando...';
      const { error } = await sb.auth.signInWithPassword({ email, password });
      if(error){
        authMsg.textContent = 'Não entrou. Confira Email e Senha.';
        return;
      }
      closeLogin();
      await refreshMode();
    });

    btnLogout.addEventListener('click', async ()=>{
      if(!sb){ return; }
      await sb.auth.signOut();
      await refreshMode();
    });

function travarIframeJogador(iframe){
  try{
    const doc = iframe.contentDocument || iframe.contentWindow.document;
    if(!doc) return;

    // cria/atualiza a tarja vermelha
    let banner = doc.getElementById("TESOURA_JOGADOR_BANNER");
    if(!banner){
      banner = doc.createElement("div");
      banner.id = "TESOURA_JOGADOR_BANNER";
      banner.textContent = "MODO JOGADOR: SOMENTE VISUALIZAÇÃO";
      banner.style.cssText =
        "position:fixed;top:0;left:0;right:0;z-index:999999;" +
        "background:#b91c1c;color:#fff;font-weight:900;" +
        "padding:8px 10px;text-align:center;font-size:12px;";
      doc.body.appendChild(banner);

      // empurra a página para baixo (pra não cobrir o topo)
      doc.body.style.paddingTop = "40px";
    }

    // desativa cliques em botões/campos/links, mas mantém rolagem
    let style = doc.getElementById("TESOURA_JOGADOR_LOCK");
    if(!style){
      style = doc.createElement("style");
      style.id = "TESOURA_JOGADOR_LOCK";
      style.textContent = `
        button, input, select, textarea, a, [role="button"], [onclick] {
          pointer-events: none !important;
          opacity: 0.55 !important;
          cursor: not-allowed !important;
        }
      `;
      doc.head.appendChild(style);
    }
  }catch(e){
    // se algum iframe não permitir acesso, só ignora
  }
}
    
    function cacheBust(url){
      const sep = url.includes('?') ? '&' : '?';
      return url + sep + 'cb=' + Date.now();
    }

    function setIframeSrc(iframe){
      if(!iframe) return;
      const base = iframe.getAttribute('data-src');
      if(!base) return;
      iframe.setAttribute('src', cacheBust(base));
      iframe.addEventListener("load", ()=>{
  const role = sessionStorage.getItem("TESOURA_ROLE");
  if(role === "jogador") travarIframeJogador(iframe);
}, { once: true });
    }

    function abrirAba(id){
      const abas=document.querySelectorAll('.tab-content');
      const botoes=document.querySelectorAll('.tab-btn');

      abas.forEach(a=>a.classList.remove('active'));
      botoes.forEach(b=>b.classList.remove('active'));

      document.getElementById(id).classList.add('active');

      const map = {
        "aba-jogadores":0,"aba-presenca":1,"aba-controle":2,"aba-mensalidade":3,"aba-caixa":4,"aba-gols":5,"aba-banco":6
      };
      botoes[map[id]].classList.add('active');

      const iframe = document.querySelector('#' + id + ' iframe');
      setIframeSrc(iframe);
    }

    // carrega a primeira aba ao abrir
    window.addEventListener('load', async ()=>{initViewGate();
      await refreshMode();
      setIframeSrc(document.getElementById('f-jogadores'));
    });
  </script>
<script>
  // ===== CONFIG =====
  const SENHA_JOGADORES = "TESOURA2026"; // troque aqui se quiser
  const KEY_ROLE = "TESOURA_ROLE"; // sessionStorage
  // ==================

  function bloquearEdicaoPresencaNoPublico(){
    // trava botões do painel presença quando NÃO estiver em diretoria
    const role = sessionStorage.getItem(KEY_ROLE);
    if(role !== "jogador") return; // só trava no modo jogador

    const textos = [
      "CHEGOU AGORA",
      "LIMPAR HOJE",
      "ESCALAR 1º TEMPO",
      "ESCALAR 2º TEMPO",
      "SALVAR",
      "EXCLUIR",
      "NÃO VAI JOGAR"
    ];

    const buttons = Array.from(document.querySelectorAll("button"));
    buttons.forEach(b=>{
      const t = (b.innerText || "").trim().toUpperCase();
      if(textos.includes(t)){
        b.disabled = true;
        b.style.opacity = "0.45";
        b.style.cursor = "not-allowed";
        b.title = "Somente Diretoria";
      }
    });
  }

  function initTelaInicial(){
    const tela = document.getElementById("telaInicial");
    const msg  = document.getElementById("msgTelaInicial");
    const bJog = document.getElementById("btnEntrarJogadores");
    const bDir = document.getElementById("btnEntrarDiretoria");

    // sempre começa mostrando a tela inicial (evita “não pediu senha”)
    sessionStorage.removeItem(KEY_ROLE);

    bJog.onclick = ()=>{
      const s = prompt("Senha para VISUALIZAR (Jogadores):") || "";
      if(s.trim() === SENHA_JOGADORES){
        sessionStorage.setItem(KEY_ROLE, "jogador");
        setTimeout(()=>{
  document.querySelectorAll("iframe").forEach(travarIframeJogador);
}, 400);
        tela.style.display = "none";
        setTimeout(bloquearEdicaoPresencaNoPublico, 300);
      }else{
        msg.textContent = "Senha incorreta.";
      }
    };

    bDir.onclick = ()=>{
      sessionStorage.setItem(KEY_ROLE, "diretoria");
      tela.style.display = "none";

      // tenta clicar automaticamente no botão existente "ENTRAR (DIRETORIA)"
      setTimeout(()=>{
        const btns = Array.from(document.querySelectorAll("button,a"));
        const alvo = btns.find(el => ((el.innerText||"").toUpperCase().includes("ENTRAR") && (el.innerText||"").toUpperCase().includes("DIRETORIA")));
        if(alvo) alvo.click();
      }, 200);
    };
  }

  window.addEventListener("load", ()=>{
    initTelaInicial();
  });
</script>
  
</body>
</html>
