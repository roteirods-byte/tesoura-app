<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TESOURA - CONTROLE DO FUTEBOL</title>
  <meta name="theme-color" content="#0b1630" />
  <style>
    :root{
      --bg:#071428;
      --card:#0b1630;
      --card2:#0a142a;
      --line:#243a63;
      --txt:#ffffff;
      --muted:#b9c7e6;
      --orange:#ff8a00;
      --green:#00c67a;
      --red:#ff4d4d;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(1200px 500px at 20% 0%, #0f2350 0%, var(--bg) 60%) fixed;
      color:var(--txt);
    }
    .top{
      display:flex;align-items:center;justify-content:space-between;
      padding:14px 16px;
      border-bottom:1px solid rgba(255,138,0,.35);
      background: linear-gradient(180deg, rgba(11,22,48,.98), rgba(11,22,48,.72));
      position:sticky;top:0;z-index:50;
    }
    .brand{font-weight:900;letter-spacing:.8px;color:var(--orange)}
    .build{
      display:flex;gap:10px;align-items:center;
      font-weight:700;font-size:12px;color:#d8e4ff;
    }
    .chip{padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.10)}

    .wrap{max-width:860px;margin:24px auto;padding:0 16px}
    .card{
      background: linear-gradient(180deg, rgba(11,22,48,.95), rgba(11,22,48,.78));
      border:1px solid rgba(255,255,255,.08);
      border-radius:16px;
      box-shadow: 0 16px 40px rgba(0,0,0,.35);
      padding:18px;
    }
    h1{margin:0 0 10px 0;font-size:22px}
    .muted{color:var(--muted);font-size:13px}
    .row{display:flex;gap:10px;flex-wrap:wrap;margin-top:14px}
    label{font-size:12px;color:#d8e4ff;font-weight:800}
    input{
      width:260px;max-width:100%;
      padding:10px 12px;border-radius:10px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(0,0,0,.20);
      color:var(--txt);
      outline:none;
    }
    input:focus{border-color:rgba(255,138,0,.65)}
    .btn{
      padding:10px 14px;border-radius:10px;border:0;
      font-weight:900;cursor:pointer;
    }
    .btn-ok{background:var(--green);color:#052014}
    .btn-warn{background:var(--orange);color:#2a1400}
    .btn:active{transform:scale(.99)}
    .err{margin-top:10px;color:#ffd2d2;font-weight:800;display:none}
  </style>
</head>
<body>
  <div class="top">
    <div class="brand">TESOURA — CONTROLE DO FUTEBOL</div>
    <div class="build">
      <span class="chip" id="modeChip">Modo: —</span>
      <span class="chip" id="buildChip">BUILD: —</span>
    </div>
  </div>

  <div class="wrap">
    <div class="card">
      <h1>Entrar</h1>
      <div class="muted">Digite a senha e clique em ENTRAR.</div>

      <div class="row" style="margin-top:16px;align-items:flex-end">
        <div>
          <label for="pin">SENHA</label><br/>
          <input id="pin" type="password" inputmode="numeric" autocomplete="current-password" placeholder="Digite a senha" />
        </div>
        <button class="btn btn-ok" id="btnEntrar">ENTRAR</button>
        <button class="btn btn-warn" id="btnLimpar">LIMPAR</button>
      </div>

      <div class="err" id="errBox">Senha inválida.</div>
      <div class="muted" style="margin-top:14px">Dica: se abriu direto uma página do painel, use o botão SAIR e volte aqui.</div>
    </div>
  </div>

  <script>
(function(){
  "use strict";

  const AUTH_KEY = "TESOURA_AUTH"; // {ok:1, mode:"Diretoria"|"Jogadores (visual)", ts:number}
  const LS_BUILD = "TESOURA_BUILD";

  function qp(name){
    try{ return new URLSearchParams(location.search).get(name); }catch(e){ return null; }
  }

  function getBase(){
    const p = location.pathname;
    const marker = "/tesoura-app/";
    const i = p.indexOf(marker);
    if(i >= 0) return p.slice(0, i + marker.length);
    const parts = p.split("/");
    parts.pop();
    return parts.join("/") + "/";
  }

  function getBuild(){
    const b = qp("build") || localStorage.getItem(LS_BUILD) || "";
    if(b) localStorage.setItem(LS_BUILD, b);
    return b;
  }

  function getGoto(){
    const g = qp("goto");
    return g ? decodeURIComponent(g) : "";
  }

  function setAuth(mode){
    const payload = { ok: 1, mode, ts: Date.now() };
    localStorage.setItem(AUTH_KEY, JSON.stringify(payload));
    localStorage.setItem("TESOURA_MODE", mode);
  }

  function getAuth(){
    try{
      const raw = localStorage.getItem(AUTH_KEY);
      return raw ? JSON.parse(raw) : null;
    }catch(e){ return null; }
  }

  function isLogged(){
    const a = getAuth();
    return !!(a && a.ok === 1 && a.mode);
  }

  function acceptPin(pin){
    const p = String(pin || "").trim();

    // Jogadores (visual): PIN único
    const PIN_JOGADOR = "TESOURA2026";

    // Diretoria: 5 senhas (sem email)
    const PINS_DIRETORIA = new Set(["1baidec","2thiago","3love","4le","5titi"]);

    if(p === PIN_JOGADOR) return { ok:true, mode:"Jogadores (visual)" };
    if(PINS_DIRETORIA.has(p)) return { ok:true, mode:"Diretoria" };
    return { ok:false, mode:"" };
  }

  function buildQS(){
    const b = getBuild();
    return b ? ("?build=" + encodeURIComponent(b)) : "";
  }

  function goAfterLogin(){
    // destino padrão: página com TODAS as abas (shell)
    const url = new URL(location.href);
    const next = url.searchParams.get("next"); // opcional: retornar para uma página específica
    const build = url.searchParams.get("build") || "2025-12-27_noiframe_v1";

    // Se veio de um painel e guardou "next", respeita.
    if(next){
      location.href = next;
      return;
    }

    // Shell oficial (aba com todos os painéis)
    location.href = BASE + "legacy/tesoura_app_abas_R10.html?build=" + encodeURIComponent(build);
  }

  // UI
  const elPin = document.getElementById("pin");
  const elBtn = document.getElementById("btnEntrar");
  const elClear = document.getElementById("btnLimpar");
  // Mensagens (alguns layouts não têm #msg; usamos #errBox como fallback)
  const elMsg = document.getElementById("msg") || document.getElementById("errBox");

  function setMsg(text){
    const el = document.getElementById("msg");
    if(!el) return;
    if(!text){
      el.textContent = "";
      el.style.display = "none";
      return;
    }
    el.textContent = String(text);
    el.style.display = "block";
  }

  function onEnter(){
    const v = (elPin.value || "").trim();
    const r = acceptPin(v);
    if(!r.ok){
      setMsg("Senha inválida.");
      elPin.focus();
      return;
    }
    setAuth(r.mode);
    setMsg("");
    goAfterLogin();
  }

  function onClear(){
    elPin.value = "";
    setMsg("");
    elPin.focus();
  }

  elBtn.addEventListener("click", onEnter);
  elClear.addEventListener("click", onClear);
  elPin.addEventListener("keydown", (e)=>{ if(e.key === "Enter") onEnter(); });

  // Se já estiver logado, manda direto pro painel
  if(isLogged()){
    goAfterLogin();
  }else{
    const b = getBuild();
    const badge = document.getElementById("buildBadge");
    if(badge) badge.textContent = b ? ("BUILD: " + b) : "BUILD: —";
  }
})();

</script>
</body>
</html>